    <!-- Firebase SDKs -->
    <script type="module">
        // Import des fonctions nécessaires du SDK Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
        // Si vous n'utilisez pas Analytics, vous pouvez commenter ou supprimer la ligne suivante
        // import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";

        // Votre configuration Firebase pour l'application web
        // C'est le code que Firebase vous a généré
        const firebaseConfig = {
            apiKey: "AIzaSyA1AoHpUpvD12YUzLe91SWNpxmPRPB36aQ",
            authDomain: "easyplayapp-97e15.firebaseapp.com",
            projectId: "easyplayapp-97e15",
            storageBucket: "easyplayapp-97e15.firebasestorage.app",
            messagingSenderId: "741324257784",
            appId: "1:741324257784:web:06a85e1f10b8dc804afe0d",
            measurementId: "G-YPJHRXB1TP" // Optionnel, si vous n'utilisez pas Analytics
        };

        // Variables globales pour Firebase (seront initialisées après l'authentification)
        let app;
        let db;
        let auth;
        let userId; // Pour stocker l'ID de l'utilisateur

        // Variables fournies par l'environnement Canvas (laissez-les telles quelles)
        // Elles ne seront utilisées que si le code est exécuté dans Canvas
        const appIdFromCanvas = typeof __app_id !== 'undefined' ? __app_id : firebaseConfig.projectId; // Utilise projectId si pas dans Canvas
        const initialAuthTokenFromCanvas = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Initialisation de Firebase et de l'authentification
        function initializeFirebaseAndAuth() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Si vous utilisez Analytics, décommentez la ligne suivante
                // const analytics = getAnalytics(app);

                // Écouteur pour les changements d'état d'authentification
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        // L'utilisateur est connecté
                        userId = user.uid;
                        console.log("Firebase: Authentifié avec succès. User ID:", userId);
                    } else {
                        // L'utilisateur est déconnecté ou n'a jamais été connecté
                        console.log("Firebase: Utilisateur non authentifié. Tentative de connexion anonyme...");
                        try {
                            if (initialAuthTokenFromCanvas) {
                                // Tente de se connecter avec le token fourni par Canvas
                                await signInWithCustomToken(auth, initialAuthTokenFromCanvas);
                                console.log("Firebase: Connecté avec le token personnalisé.");
                            } else {
                                // Sinon, se connecte de manière anonyme
                                await signInAnonymously(auth);
                                console.log("Firebase: Connecté de manière anonyme.");
                            }
                            userId = auth.currentUser.uid;
                        } catch (error) {
                            console.error("Firebase: Erreur d'authentification:", error);
                            // Fallback si l'authentification échoue, utiliser un ID aléatoire
                            userId = crypto.randomUUID();
                            console.warn("Firebase: Utilisation d'un ID utilisateur aléatoire en raison d'une erreur d'authentification.");
                        }
                    }
                    // Rendre les fonctions Firebase globales pour le reste de votre script.js
                    // C'est essentiel pour que votre script principal puisse interagir avec Firebase
                    window.db = db;
                    window.auth = auth;
                    window.userId = userId;
                    window.appId = appIdFromCanvas; // Utilise l'ID du projet ou celui de Canvas
                    window.doc = doc;
                    window.getDoc = getDoc;
                    window.addDoc = addDoc;
                    window.setDoc = setDoc;
                    window.updateDoc = updateDoc;
                    window.deleteDoc = deleteDoc;
                    window.onSnapshot = onSnapshot;
                    window.collection = collection;
                    window.query = query;
                    window.where = where;
                    window.getDocs = getDocs;

                    // Si votre script.js a une fonction de chargement de données qui doit être appelée
                    // après l'initialisation complète de Firebase, c'est ici qu'elle devrait être déclenchée.
                    // Dans votre cas, le script.js contient déjà un setInterval qui attend window.db et window.userId.
                });

            } catch (error) {
                console.error("Firebase: Erreur lors de l'initialisation de Firebase:", error);
                // En cas d'échec d'initialisation, utiliser un ID utilisateur aléatoire
                userId = crypto.randomUUID();
                window.userId = userId;
                window.appId = appIdFromCanvas;
            }
        }

        // Appeler l'initialisation de Firebase lorsque le DOM est chargé
        // ou immédiatement si le DOM est déjà chargé
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeFirebaseAndAuth);
        } else {
            initializeFirebaseAndAuth();
        }

        // Expose Firebase functions globally as placeholders initially
        // These will be properly set in onAuthStateChanged once Firebase is ready.
        window.db = null;
        window.auth = null;
        window.userId = null;
        window.appId = null;
        window.doc = null;
        window.getDoc = null;
        window.addDoc = null;
        window.setDoc = null;
        window.updateDoc = null;
        window.deleteDoc = null;
        window.onSnapshot = null;
        window.collection = null;
        window.query = null;
        window.where = null;
        window.getDocs = null;

    </script>
    <!-- XLSX library for Excel import/export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Votre script principal -->
    <script src="src/script.js"></script>
