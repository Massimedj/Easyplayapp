<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyPlay - Gestionnaire de Tournoi Sportif</title>
    <!-- Favicon -->
    <link rel="icon" href="images/Logo_EsayPlay.png" type="image/png"> <!-- Chemin corrigé si votre favicon est ici -->
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome CDN pour les icônes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Police Inter de Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Votre CSS existant */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Couleur de fond légère */
            margin: 0;
            padding: 0;
            overflow-x: hidden; /* Empêche le défilement horizontal */
        }
        /* Style pour les équipes gagnantes et perdantes dans les éliminatoires */
        .winner-team {
            font-weight: bold;
            color: #10B981; /* Vert */
        }
        .loser-team {
            color: #EF4444; /* Rouge */
            text-decoration: line-through;
        }
        /* Styles pour la modale */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            transition: opacity 0.3s ease-out;
        }
        /* Animations */
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-down { animation: fadeInDown 0.5s ease-out forwards; }
        .animate-fade-in-up { animation: fadeInUp 0.5s ease-out forwards; }
    </style>
</head>
<body class="bg-gray-100 font-inter">
    <!-- Barre de navigation -->
    <nav class="bg-blue-700/90 p-4 shadow-lg fixed w-full top-0 z-40 backdrop-blur-sm">
        <div class="container mx-auto flex justify-between items-center">
            <a href="#home" class="text-white text-2xl font-bold flex items-center">
                <img src="images/Logo_EsayPlay.png" alt="EasyPlay Logo" class="h-8 w-8 mr-2 rounded-full">
                EasyPlay
            </a>
            <div class="space-x-4">
                <a href="#teams" class="text-white hover:text-blue-200 transition-colors duration-200">Équipes</a>
                <a href="#brassage-phases" class="text-white hover:text-blue-200 transition-colors duration-200">Brassages</a>
                <a href="#elimination-phases" class="text-white hover:text-blue-200 transition-colors duration-200">Éliminations</a>
                <a href="#secondary-groups" class="text-white hover:text-blue-200 transition-colors duration-200">Groupes Secondaires</a>
            </div>
        </div>
    </nav>

    <!-- Conteneur principal de l'application -->
    <main id="app-container" class="pt-20">
        <!-- Le contenu des pages sera injecté ici par JavaScript -->
    </main>

    <!-- Modale globale -->
    <div id="globalModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300 opacity-0 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full mx-auto transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
            <h3 id="modalTitle" class="text-lg font-bold text-gray-900 mb-4">Titre de la modale</h3>
            <div id="modalBody" class="text-gray-700 mb-6">
                <!-- Contenu de la modale -->
            </div>
            <div class="flex justify-end space-x-3">
                <button id="modalCancelBtn" type="button"
                        class="inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                    Annuler
                </button>
                <button id="modalConfirmBtn" type="button"
                        class="inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                    Confirmer
                </button>
            </div>
        </div>
    </div>

    <!-- Conteneur pour les toasts (messages temporaires) -->
    <div id="toast-container" class="fixed top-4 right-4 z-[100] flex flex-col space-y-2"></div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Import des fonctions nécessaires du SDK Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
        // Si vous n'utilisez pas Analytics, vous pouvez commenter ou supprimer la ligne suivante
        // import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";

        // Votre configuration Firebase pour l'application web
        // C'est le code que Firebase vous a généré
        const firebaseConfig = {
            apiKey: "AIzaSyA1AoHpUpvD12YUzLe91SWNpxmPRPB36aQ",
            authDomain: "easyplayapp-97e15.firebaseapp.com",
            projectId: "easyplayapp-97e15",
            storageBucket: "easyplayapp-97e15.firebasestorage.app",
            messagingSenderId: "741324257784",
            appId: "1:741324257784:web:06a85e1f10b8dc804afe0d",
            measurementId: "G-YPJHRXB1TP" // Optionnel, si vous n'utilisez pas Analytics
        };

        // Variables globales pour Firebase (seront initialisées après l'authentification)
        let app;
        let db;
        let auth;
        let userId; // Pour stocker l'ID de l'utilisateur

        // Variables fournies par l'environnement Canvas (laissez-les telles quelles)
        // Elles ne seront utilisées que si le code est exécuté dans Canvas
        const appIdFromCanvas = typeof __app_id !== 'undefined' ? __app_id : firebaseConfig.projectId; // Utilise projectId si pas dans Canvas
        const initialAuthTokenFromCanvas = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Initialisation de Firebase et de l'authentification
        function initializeFirebaseAndAuth() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Si vous utilisez Analytics, décommentez la ligne suivante
                // const analytics = getAnalytics(app);

                // Écouteur pour les changements d'état d'authentification
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        // L'utilisateur est connecté
                        userId = user.uid;
                        console.log("Firebase: Authentifié avec succès. User ID:", userId);
                    } else {
                        // L'utilisateur est déconnecté ou n'a jamais été connecté
                        console.log("Firebase: Utilisateur non authentifié. Tentative de connexion anonyme...");
                        try {
                            if (initialAuthTokenFromCanvas) {
                                // Tente de se connecter avec le token fourni par Canvas
                                await signInWithCustomToken(auth, initialAuthTokenFromCanvas);
                                console.log("Firebase: Connecté avec le token personnalisé.");
                            } else {
                                // Sinon, se connecte de manière anonyme
                                await signInAnonymously(auth);
                                console.log("Firebase: Connecté de manière anonyme.");
                            }
                            userId = auth.currentUser.uid;
                        } catch (error) {
                            console.error("Firebase: Erreur d'authentification:", error);
                            // Fallback si l'authentification échoue, utiliser un ID aléatoire
                            userId = crypto.randomUUID();
                            console.warn("Firebase: Utilisation d'un ID utilisateur aléatoire en raison d'une erreur d'authentification.");
                        }
                    }
                    // Rendre les fonctions Firebase globales pour le reste de votre script.js
                    // C'est essentiel pour que votre script principal puisse interagir avec Firebase
                    window.db = db;
                    window.auth = auth;
                    window.userId = userId;
                    window.appId = appIdFromCanvas; // Utilise l'ID du projet ou celui de Canvas
                    window.doc = doc;
                    window.getDoc = getDoc;
                    window.addDoc = addDoc;
                    window.setDoc = setDoc;
                    window.updateDoc = updateDoc;
                    window.deleteDoc = deleteDoc;
                    window.onSnapshot = onSnapshot;
                    window.collection = collection;
                    window.query = query;
                    window.where = where;
                    window.getDocs = getDocs;

                    // Si votre script.js a une fonction de chargement de données qui doit être appelée
                    // après l'initialisation complète de Firebase, c'est ici qu'elle devrait être déclenchée.
                    // Dans votre cas, le script.js contient déjà un setInterval qui attend window.db et window.userId.
                });

            } catch (error) {
                console.error("Firebase: Erreur lors de l'initialisation de Firebase:", error);
                // En cas d'échec d'initialisation, utiliser un ID utilisateur aléatoire
                userId = crypto.randomUUID();
                window.userId = userId;
                window.appId = appIdFromCanvas;
            }
        }

        // Appeler l'initialisation de Firebase lorsque le DOM est chargé
        // ou immédiatement si le DOM est déjà chargé
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeFirebaseAndAuth);
        } else {
            initializeFirebaseAndAuth();
        }

        // Expose Firebase functions globally as placeholders initially
        // These will be properly set in onAuthStateChanged once Firebase is ready.
        window.db = null;
        window.auth = null;
        window.userId = null;
        window.appId = null;
        window.doc = null;
        window.getDoc = null;
        window.addDoc = null;
        window.setDoc = null;
        window.updateDoc = null;
        window.deleteDoc = null;
        window.onSnapshot = null;
        window.collection = null;
        window.query = null;
        window.where = null;
        window.getDocs = null;

    </script>
    <!-- XLSX library for Excel import/export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Votre script principal -->
    <script src="src/script.js"></script>
</body>
</html>
